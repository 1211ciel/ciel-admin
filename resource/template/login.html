<!--
=================================================================================
 This is auto-generated by FreeKey Admin at 2022-07-13 19:06:16. For more information see https://github.com/1211ciel/ciel-admin
=================================================================================
-->
<!DOCTYPE html>
<html lang="zh">
<head>
    {{include "/part/meta.html" .}} <title>登录 - {{.Config.server.name}} </title>
    <style>
        .w {
            max-width: 1200px;
        }

        .music-list {
            position: fixed;
            top: 56%;
            left: 23%;
        }

        #music:hover {
            opacity: 1;
        }

        .music-list ul li {
            display: flex;
            align-items: center;
        }

        .music-list video {
            margin-left: 10px;
            width: 330px;
            height: 22px;
        }
    </style>
</head>
<body>
{{include "/part/top.html" .}}

<!--<div class="music-list">-->
<!--    <iframe id="music" style="opacity: 0.6;border-radius: 3px" width="360" height="215" title="YouTube video player" frameborder="0"-->
<!--            allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture"-->
<!--            allowfullscreen></iframe>-->
<!--</div>-->
<div id="wrapper">
    <div class="w">
        <div id="wrapper-left">
            <div class="box no-bottom-border">
                <div class="cell">
                    <a href="#" class=" hover-underline mr-3">{{.Config.server.name}}</a> <span class="mr-3">›</span> 管理员登录
                    <li class="fa fa-lock"></li>
                </div>
                <form class="cell" id="login-form">
                    <table class="table-add" cellpadding="10" cellspacing="10" width="100%" border="0">
                        <tr>
                            <td width="120" align="right">用户名</td>
                            <td><input type="text" name="uname" autocomplete="off"></td>
                        </tr>
                        <tr>
                            <td width="120" align="right">密码</td>
                            <td><input type="password" name="pwd"></td>
                        </tr>
                        <tr>
                            <td></td>
                            <td><img id="code" onclick="getCaptcha()" style="width: 187px;border-radius: 8px; height: 60px; "></td>
                        </tr>
                        <tr>
                            <td align="right">你是机器人吗？</td>
                            <td><input type="text" id="captcha" name="code" placeholder="请输入验证码,点击可以更换图片" autocomplete="off"></td>
                        </tr>
                        <tr>
                            <td></td>
                            <td>
                                <button class="btn-info" id="login-btn" type="button" onclick="handleLogin()">登陆</button>
                            </td>
                        </tr>
                    </table>
                </form>
            </div>
        </div>
        <div id="wrapper-right">
            <div class="box">
                <div class="cell">
                    <span class="color-desc fs-12">一起听音乐</span>
                </div>
                <div class="cell no-bottom-border">
                    <iframe id="music" style="opacity: 0.5;border-radius: 3px" width="260" height="234" title="YouTube video player" frameborder="0"
                            allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture"
                            allowfullscreen></iframe>
                </div>
            </div>
        </div>
    </div>
</div>
{{include "/part/footer.html" .}}
{{include "/part/endJs.html" .}}
<script>
    let id = 0;
    $(async function () {
        await getCaptcha()
        $("input").keyup(function (e) {
            if (e.keyCode === 13) {
                handleLogin()
            }
        })

        let res = await $.get('/v1/dict/key/music-url')
        if (res.code === 0) {
            if (res.data !== '') {
                url = res.data
            }
            document.getElementById('music').src = url
        }
    })

    function handleLogin() {
        $.post("/admin/login", $("#login-form").serialize() + `&id=${id}`, async function (data) {
            if (data.code === 0) {
                alert('Success')
                window.open("{{.Config.home}}", "_blank");
            } else {
                alert(data.msg)
                await getCaptcha()
            }
        });
    }


    async function getCaptcha() {
        id = Math.random();
        $("#captcha").val("")
        $.get("/admin/getCaptcha?id=" + id, function (res) {
            $("#code").attr("src", res.data);
        })
    }

</script>
</body>
</html>