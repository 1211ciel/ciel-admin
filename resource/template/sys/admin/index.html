<!--
=================================================================================
 This is auto-generated by FreeKey Admin at 2022-06-27 16:27:03. For more information see https://github.com/1211ciel/ciel-admin
=================================================================================
-->
<!DOCTYPE html>
<html lang="zh">
<head>
    {{include "/part/meta.html" .}} <title>{{.node.Name}} - {{.Config.server.name}} </title>
</head>
<body>
{{include "/part/top.html" .}}
<div id="wrapper">
    <div class="w">
        <div id="wrapper-left">
            {{include "/part/nav.html" .}}
            <div class="box no-bottom-border">
                {{include "/part/page_base_info.html" .}}
                <form id="searchForm" class="cell flex-center no-bottom-border" action="{{.node.Path}}" method="get">
                    <a class="tag-info" href="{{.node.Path}}/add?{{toUrlParams .Query}}"> <i class="fa fa-plus-square" aria-hidden="true"></i></a>
                    <input id="page" name="page" value="1" hidden> <input name="size" value="{{.Query.size}}" hidden>
                    <label class="input">角色
                        <select name="admin_rid" onchange="this.form.submit()">
                            <option value="">请选择</option>
                            {{range .roles}}
                            <option value="{{.id}}" {{if eq $.Session.admin_rid .id}} selected {{end}} class="tag-success">{{.name}}</option>
                            {{end}}
                        </select>
                    </label>
                    <label class='input'>状态 <select type='text' name='admin_status' value='{{.Session.admin_status}}' onchange='this.form.submit()'>
                        <option value='' class='tag-info'>请选择</option>
                        {{option .Config.options.status .Query.admin_status}}
                    </select></label>
                </form>
            </div>
            <div class="box no-bottom-border">
                {{.msg}}
                <table class="table-1">
                    <tr>
                        <th>id</th>
                        <th>用户名</th>
                        <th>角色</th>
                        <th>状态</th>
                        <th>创建时间</th>
                        <th>操作</th>
                    </tr>
                    {{range .list}}
                    <tr>
                        <td data-label="ID">{{.id}}</td>
                        <td data-label="用户名">{{.uname}}</td>
                        <td data-label="角色">{{.role_name}}</td>
                        <td data-label="状态">{{chooseSpan $.Config.options.status .status}}</td>
                        <td data-label="创建时间">{{.created_at}}</td>
                        <td data-label="操作" align="center">
                            <a href="#" class="tag-info" onclick=" location.href='{{$.node.Path}}/edit/{{.id}}?{{toUrlParams $.Query}}'"><i class="fa fa-wrench" aria-hidden="true"></i></a>
                            <a href="#" class="tag-danger" onclick="if(confirm('确认删除?')){location.href='{{$.node.Path}}/del/{{.id}}?{{toUrlParams $.Query}}'}"><i class="fa fa-trash"></i></a>
                            <a href="#" class="tag-warning" onclick="updateUnameById('{{.id}}')">用户名</a>
                            <a href="#" class="tag-success" onclick="updatePwdById('{{.id}}')">密码</a>
                        </td>
                    </tr>
                    {{end}}
                </table>
                {{include "/part/pagination.html" .}}
            </div>
        </div>
    </div>
</div>
{{include "/part/footer.html" .}}
{{include "/part/endJs.html" .}}
<script>
    async function updatePwdById(id) {
        let pwd = prompt('请输入新密码')
        if (pwd) {
            let res = await $.put('/admin/admin/updatePwdWithoutOldPwd', {id, pwd})
            alert(res.msg)
        }
    }

    async function updateUnameById(id) {
        let uname = prompt('请输入新的用户名')
        if (uname) {
            let res = await $.put("/admin/admin/updateUname", {id, uname})
            if (res.code !== 0) {
                alert(res.msg)
            } else {
                location.reload()
            }
        }
    }
</script>
</body>
</html>