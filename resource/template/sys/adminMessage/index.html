<!--
=================================================================================
 This is auto-generated by FreeKey Admin at 2022-07-22 20:14:53. For more information see https://github.com/1211ciel/ciel-admin
=================================================================================
-->
<!DOCTYPE html>
<html lang="zh">
<head>
    {{include "/part/meta.html" .}} <title>{{.node.Name}} - {{.Config.server.name}} </title>
    <style>
        .table-add td input, textarea, select {
            width: 242px;
        }
    </style>
</head>
<body>
{{include "/part/top.html" .}}
<div id="wrapper">
    <div class="w">
        <div id="wrapper-left" style="position: relative">
            {{include "/part/nav.html" .}}
            <div class="box no-bottom-border">
                {{include "/part/page_base_info.html" .}}
                <form id="searchForm" class="cell flex-center no-bottom-border" action="{{.node.Path}}" method="get">
                    <input id="page" name="page" value="1" hidden> <input name="size" value="{{.Query.size}}" hidden>
                    <label class="input">发送者 <input type="text" name="adminMessage_from_uname" value="{{.Session.adminMessage_from_uname}}" onkeydown="if(event.keyCode===13)this.form.submit()"></label><label class="input">接收者 <input type="text" name="adminMessage_to_uname" value="{{.Session.adminMessage_to_uname}}" onkeydown="if(event.keyCode===13)this.form.submit()"></label>
                    <label class='input'>分组 <select type='text' name='adminMessage_group' value='{{.Session.adminMessage_group}}' onchange='this.form.submit()'>
                        <option value='' class='tag-info'>请选择</option>
                        {{option "1:系统:tag-info,2:管理员:tag-warning,3:其他:tag-danger" .Query.adminMessage_group}}</select></label>
                    <label class='input'>类型 <select type='text' name='adminMessage_type' value='{{.Session.adminMessage_type}}' onchange='this.form.submit()'>
                        <option value='' class='tag-info'>请选择</option>
                        {{option "1:文字:tag-info,2:图片:tag-primary,3:语音:tag-warning,4:视频:tag-success,5:链接:tag-danger" .Query.adminMessage_type}}</select></label><label class="input">内容 <input type="text" name="adminMessage_content" value="{{.Session.adminMessage_content}}" onkeydown="if(event.keyCode===13)this.form.submit()"></label><label class="input">链接 <input type="text" name="adminMessage_link" value="{{.Session.adminMessage_link}}" onkeydown="if(event.keyCode===13)this.form.submit()"></label>
                    <label class='input ml-12'>
                        <select id="groupOptions" name='adminMessage_group' value='{{.Session.adminMessage_group}}'>
                            <option value='' class='tag-info'>请选择分组</option>
                            {{option "1:系统:tag-info,2:管理员:tag-warning,3:其他:tag-danger" ""}}</select>
                        <a href="#" class="tag-warning " onclick="handleClearMsg()">清空分组消息</a>
                    </label>
                </form>
            </div>
            <div class="box no-bottom-border">
                {{.msg}}
                <table class="table-1">
                    <tr>
                        <th>id</th>
                        <th>发送者</th>
                        <th>接收者</th>
                        <th>分组</th>
                        <th>类型</th>
                        <th>内容</th>
                        <th>链接</th>
                        <th>状态</th>
                        <th>创建时间</th>
                        <th>操作</th>
                    </tr>
                    {{range .list}}
                    <tr>
                        <td>{{.id}}</td>
                        <td data-label='发送者'>{{.from_uname}}</td>
                        <td data-label='接收者'>{{.to_uname}}</td>
                        <td data-label='分组'>{{chooseSpan "1:系统:tag-info,2:管理员:tag-warning,3:其他:tag-danger" .group}}</td>
                        <td data-label='类型'>{{chooseSpan "1:文字:tag-info,2:图片:tag-primary,3:语音:tag-warning,4:视频:tag-success,5:链接:tag-danger" .type}}</td>
                        <td data-label='内容'>{{.content}}</td>
                        <td data-label='链接'>{{.link}}</td>
                        <td>{{chooseSpan $.Config.options.status .status}}</td>
                        <td>{{.created_at}}</td>
                        <td align="center">
                            <a href="#" onclick=" location.href='{{$.node.Path}}/edit/{{.id}}?{{toUrlParams $.Query}}'" class="tag-info"><i class="fa fa-wrench" aria-hidden="true"></i></a>
                            <a href="#" onclick="if(confirm('确认删除?')){location.href='{{$.node.Path}}/del/{{.id}}?{{toUrlParams $.Query}}'}" class="tag-danger"><i class="fa fa-trash"></i></a>
                        </td>
                    </tr>
                    {{end}}
                </table>
                {{include "/part/pagination.html" .}}
            </div>
            <div class="box no-bottom-border" style="width: 333px;">
                <form class="cell" method="post" action="/admin/adminMessage/post?{{toUrlParams .Query}}">
                    <table class="table-add" cellspacing="5" cellpadding="0" border="0">
                        <tr>
                            <input hidden name='from_uid' value='{{.Session.adminMessage_edit.from_uid}}'>
                        </tr>
                        <tr>
                            <td width='160' align='right'>接受者</td>
                            <td><select name='to_uid'>{{option .adminOptions .Session.adminMessage_edit.toUid}}</select></td>
                        </tr>
                        <tr>
                            <td align='right'>分组</td>
                            <td><select name='group'>{{option "1:系统:tag-info,2:管理员:tag-warning,3:其他:tag-danger" .Session.adminMessage_edit.group}}</select></td>
                        </tr>
                        <tr>
                            <td align='right'>类型</td>
                            <td><select name='type'>{{option "1:文字:tag-info,2:图片:tag-primary,3:语音:tag-warning,4:视频:tag-success,5:链接:tag-danger" .Session.adminMessage_edit.type}}</select></td>
                        </tr>
                        <tr>
                            <td width='160' align='right'>内容</td>
                            <td width='auto' align='left'><input required name='content' value='{{.Session.adminMessage_edit.content}}'></td>
                        </tr>
                        <tr>
                            <td width='160' align='right'>链接</td>
                            <td width='auto' align='left'><input name='link' value='{{.Session.adminMessage_edit.link}}'></td>
                        </tr>
                        <tr>
                            <td></td>
                            <td>
                                <button class="btn-info" type="submit">提交</button>
                            </td>
                        </tr>
                    </table>
                </form>
            </div>
        </div>
    </div>
</div>
{{include "/part/footer.html" .}}
{{include "/part/endJs.html" .}}
<script>
    const handleClearMsg = async () => {
        let selected = $("#groupOptions").val();
        if (!selected) {
            alert('请选择分组')
            return
        }
        let res = await $.get("/admin/adminMessage/clear?group=" + selected)
        if (res.code !== 0) {
            alert(res.msg)
        } else {
            alert(res.msg)
            location.reload()
        }
    }
</script>
</body>
</html>